<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∞–Ω–∞–ª–∏–∑–∞ —Ç–µ–ª–∞</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    /* –ù–µ–±–æ–ª—å—à–æ–π helper –¥–ª—è —Ä–∞—Å–∫—Ä—ã–≤–∞—é—â–∏—Ö—Å—è –ø–æ–¥—Å–∫–∞–∑–æ–∫ */
    document.addEventListener('alpine:init', () => {});
  </script>
</head>
<body class="bg-gray-100 min-h-screen py-8 px-4">

  <div class="max-w-4xl mx-auto">

    <!-- HEADER CARD -->
    <div
      class="relative overflow-hidden rounded-2xl shadow-md mb-8
             bg-gradient-to-r from-blue-600 via-indigo-600 to-purple-600 p-[1px]">
      <div class="bg-white rounded-2xl p-6">
        <h1 class="text-2xl md:text-3xl font-bold text-gray-800 mb-2 flex items-center gap-2">
          üìä –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∞–Ω–∞–ª–∏–∑–∞ —Ç–µ–ª–∞
        </h1>
        {% if error %}
          <p class="text-gray-600">–ú—ã –Ω–µ —Å–º–æ–≥–ª–∏ –∏–∑–≤–ª–µ—á—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.</p>
        {% else %}
          <p class="text-gray-600">–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º.</p>
        {% endif %}
      </div>
    </div>

    {% if error %}
      <!-- ERROR BLOCK -->
      <div class="bg-yellow-50 border-l-4 border-yellow-500 rounded p-5 mb-8 text-yellow-800">
        <h2 class="font-semibold mb-1">‚ö†Ô∏è –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö</h2>
        <p class="text-sm leading-relaxed">{{ error }}</p>
      </div>

      <!-- FIX / HELP -->
      <div class="bg-white rounded-xl shadow p-6 mb-8">
        <h3 class="font-semibold text-gray-800 mb-2">–ß—Ç–æ –¥–µ–ª–∞—Ç—å?</h3>
        <ol class="list-decimal ml-5 text-sm text-gray-700 space-y-1">
          <li>–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–æ—Ç–æ —Å–¥–µ–ª–∞–Ω–æ <strong>–∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è / —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –±–∏–æ–∏–º–ø–µ–¥–∞–Ω—Å–∞</strong>.</li>
          <li>–í—Å—è —Ç–∞–±–ª–∏—Ü–∞ –∑–Ω–∞—á–µ–Ω–∏–π –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤ –∫–∞–¥—Ä–µ –∏ —á–∏—Ç–∞–±–µ–ª—å–Ω–∞.</li>
          <li>–ü–æ–≤—Ç–æ—Ä–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å–∫—Ä–∏–Ω –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.</li>
          <li>–ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç –∏–ª–∏ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç ‚Äî —Å–≤—è–∂–∏—Ç–µ—Å—å —Å —Ç—Ä–µ–Ω–µ—Ä–æ–º.</li>
        </ol>
        <a href="/profile"
           class="inline-block mt-4 text-blue-600 hover:text-blue-700 hover:underline">
          ‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –ø—Ä–æ—Ñ–∏–ª—å
        </a>
      </div>

    {% elif data %}
      <!-- MAIN CONFIRM CARD -->
      <form method="POST" action="/confirm_analysis" class="space-y-10">

        <!-- IMPORTANT NOTICE -->
        <div class="bg-white rounded-xl shadow p-6 mb-4">
          <div class="flex items-start gap-3">
            <div class="text-2xl leading-none">üîí</div>
            <div>
              <h2 class="font-semibold text-gray-800 mb-1">–§–∏–∫—Å–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö</h2>
              <p class="text-sm text-gray-700 leading-relaxed">
                –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è <strong>—Å—Ç—Ä–æ–≥–æ –ø–æ –¥–∞–Ω–Ω—ã–º, —Å—á–∏—Ç–∞–Ω–Ω—ã–º —Å–æ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞ –∏–∑ –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –±–∏–æ–∏–º–ø–µ–¥–∞–Ω—Å–∞</strong>.
                –ò–∑–º–µ–Ω–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –≤—Ä—É—á–Ω—É—é –Ω–µ–ª—å–∑—è. –≠—Ç–æ —Å–¥–µ–ª–∞–Ω–æ –¥–ª—è —á–µ—Å—Ç–Ω–æ–π –¥–∏–Ω–∞–º–∏–∫–∏ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π.
              </p>
              <p class="text-sm text-gray-700 leading-relaxed mt-2">
                –ï—Å–ª–∏ –≤—ã —Å—á–∏—Ç–∞–µ—Ç–µ, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω—ã –Ω–µ–≤–µ—Ä–Ω–æ –∏–ª–∏ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é ‚Äî
                <strong>—Å–≤—è–∂–∏—Ç–µ—Å—å —Å –≤–∞—à–∏–º —Ç—Ä–µ–Ω–µ—Ä–æ–º</strong> –¥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è.
              </p>
            </div>
          </div>
        </div>

        <!-- PARAM GROUPS -->
        {% set labels = {
          "height": ("–†–æ—Å—Ç", "—Å–º", "üìè"),
          "weight": ("–í–µ—Å", "–∫–≥", "‚öñÔ∏è"),
          "bmi": ("–ò–ú–¢", "", "üìê"),
          "fat_mass": ("–ñ–∏—Ä–æ–≤–∞—è –º–∞—Å—Å–∞", "–∫–≥", "üßà"),
          "muscle_mass": ("–ú—ã—à–µ—á–Ω–∞—è –º–∞—Å—Å–∞", "–∫–≥", "üí™"),
          "muscle_percentage": ("–ü—Ä–æ—Ü–µ–Ω—Ç –º—ã—à—Ü", "%", "üí™"),
          "body_water": ("–í–æ–¥–∞ –≤ —Ç–µ–ª–µ", "%", "üíß"),
          "protein_percentage": ("–ë–µ–ª–æ–∫", "%", "ü•ö"),
          "bone_mineral_percentage": ("–ú–∏–Ω–µ—Ä–∞–ª—ã –≤ –∫–æ—Å—Ç—è—Ö", "%", "ü¶¥"),
          "skeletal_muscle_mass": ("–°–∫–µ–ª–µ—Ç–Ω—ã–µ –º—ã—à—Ü—ã", "–∫–≥", "üèãÔ∏è"),
          "visceral_fat_rating": ("–í–∏—Å—Ü–µ—Ä–∞–ª—å–Ω—ã–π –∂–∏—Ä", "", "üî•"),
          "metabolism": ("–ë–∞–∑–æ–≤—ã–π –æ–±–º–µ–Ω", "–∫–∫–∞–ª", "‚ö°"),
          "waist_hip_ratio": ("–°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Ç–∞–ª–∏—è/–±–µ–¥—Ä–∞", "", "üìè"),
          "body_age": ("–í–æ–∑—Ä–∞—Å—Ç —Ç–µ–ª–∞", "–ª–µ—Ç", "üß¨"),
          "fat_free_body_weight": ("–ë–µ–∑–∂–∏—Ä–æ–≤–∞—è –º–∞—Å—Å–∞", "–∫–≥", "üß±")
        } %}

        <!-- –û–°–ù–û–í–ù–û–ï -->
       <section class="bg-white rounded-xl shadow p-6">
  <h3 class="text-xl font-semibold text-gray-800 mb-4 flex items-center gap-2">üßç –û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h3>
  <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
    {% for key in ['height','weight','bmi','body_age'] %}
      {% if data.get(key) is not none %}
        {% set label = labels[key][0] %}
        {% set unit = labels[key][1] %}
        {% set icon = labels[key][2] %}
        <div class="bg-gray-50 border rounded-lg p-4">
          <div class="text-sm text-gray-500">{{ icon }} {{ label }}</div>

          {% if key == 'height' %}
            <input type="number" name="height" value="{{ data[key] }}"
                   class="w-full mt-1 bg-white border-gray-300 text-lg font-semibold text-gray-800 rounded px-3 py-1.5 border shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                   min="50" max="300" step="1" required>
          {% else %}
            <div class="text-lg font-bold text-gray-800 mt-1">
              {{ data[key] }}{% if unit %} {{ unit }}{% endif %}
            </div>
          {% endif %}
        </div>
      {% endif %}
    {% endfor %}
  </div>
</section>


        <!-- –°–û–°–¢–ê–í –¢–ï–õ–ê -->
        <section class="bg-white rounded-xl shadow p-6">
          <h3 class="text-xl font-semibold text-gray-800 mb-4 flex items-center gap-2">üß¨ –°–æ—Å—Ç–∞–≤ —Ç–µ–ª–∞</h3>
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
            {% for key in [
              'fat_mass','fat_free_body_weight','muscle_mass','muscle_percentage',
              'skeletal_muscle_mass','body_water','protein_percentage','bone_mineral_percentage'
            ] %}
              {% if data.get(key) is not none %}
                {% set label = labels[key][0] %}
                {% set unit = labels[key][1] %}
                {% set icon = labels[key][2] %}
                <div class="bg-gray-50 border rounded-lg p-4">
                  <div class="text-sm text-gray-500">{{ icon }} {{ label }}</div>
                  <div class="text-lg font-bold text-gray-800 mt-1">
                    {{ data[key] }}{% if unit %} {{ unit }}{% endif %}
                  </div>
                </div>
              {% endif %}
            {% endfor %}
          </div>
        </section>

        <!-- –ú–ï–¢–ê–ë–û–õ–ò–ó–ú –ò –†–ò–°–ö-–§–ê–ö–¢–û–†–´ -->
        <section class="bg-white rounded-xl shadow p-6">
          <h3 class="text-xl font-semibold text-gray-800 mb-4 flex items-center gap-2">‚ö° –ú–µ—Ç–∞–±–æ–ª–∏–∑–º –∏ —Ä–∏—Å–∫–∏</h3>
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
            {% for key in ['metabolism','visceral_fat_rating','waist_hip_ratio'] %}
              {% if data.get(key) is not none %}
                {% set label = labels[key][0] %}
                {% set unit = labels[key][1] %}
                {% set icon = labels[key][2] %}
                <div class="bg-gray-50 border rounded-lg p-4">
                  <div class="text-sm text-gray-500">{{ icon }} {{ label }}</div>
                  <div class="text-lg font-bold text-gray-800 mt-1">
                    {{ data[key] }}{% if unit %} {{ unit }}{% endif %}
                  </div>
                </div>
              {% endif %}
            {% endfor %}
          </div>
        </section>

        {% if data.analysis %}
          <!-- AI COMMENT -->
          <section class="bg-blue-50 border-l-4 border-blue-600 p-6 rounded-md">
            <h3 class="text-lg font-semibold text-blue-700 mb-2">üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ—Ç –ò–ò</h3>
            <p class="text-sm text-blue-800 whitespace-pre-line leading-relaxed">{{ data.analysis }}</p>
          </section>
        {% endif %}

        <!-- SUBMIT -->
        <div class="flex flex-col sm:flex-row sm:justify-end gap-3 pt-4">
          <a href="/profile"
             class="sm:w-auto w-full text-center px-4 py-2 rounded border border-gray-300 text-gray-700 hover:bg-gray-100 transition">
            ‚Ü©Ô∏è –û—Ç–º–µ–Ω–∏—Ç—å
          </a>
          <button type="submit"
                  class="sm:w-auto w-full px-6 py-2 rounded bg-blue-600 text-white font-semibold hover:bg-blue-700 transition">
            ‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –ø—Ä–æ—Ñ–∏–ª—å
          </button>
        </div>
      </form>
    {% endif %}
  </div>

</body>
</html>
